{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\nimport { MongoClient } from 'mongodb';\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nlet client;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>;\n  };\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    globalWithMongo._mongoClientPromise = client.connect();\n  }\n  clientPromise = globalWithMongo._mongoClientPromise;\n} else {\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AACjB;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/app/api/dashboard/charts/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport clientPromise from '@/lib/mongodb';\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const type = searchParams.get('type');\n  const client = await clientPromise;\n  const db = client.db(\"bigdata\");\n\n  try {\n    if (type === 'sentiment_dist') {\n      // Aggregation for Pie/Bar charts\n      const tenMinsAgo = new Date(Date.now() - 10 * 60 * 1000).toISOString();\n      const now = new Date(Date.now()).toISOString();\n      const stats = await db.collection(\"sentiment\")\n      .aggregate([\n        { $match: { created_at: { $gte: tenMinsAgo, $lte: now } } },\n        { $group: { _id: \"$sentiment\", count: { $sum: 1 } } }\n      ]).toArray();\n      \n      const result = { positive: 0, negative: 0, neutral: 0, unknown:0, total: 0 };\n      stats.forEach((s: any) => {\n        if (s._id in result) result[s._id as keyof typeof result] = s.count;\n        result.total += s.count;\n      });\n      return NextResponse.json(result);\n    }\n\n    if (type === 'activity_hourly') {\n      // 1. Calculate 24 hours ago\n      const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n      const activity = await db.collection(\"language\").aggregate([\n        // STEP 1: Convert the string \"created_at\" to a real Date object\n        {\n          $addFields: {\n            convertedDate: { $toDate: \"$created_at\" }\n          }\n        },\n        // STEP 2: Filter for posts in the last 24 hours\n        { \n          $match: { \n            convertedDate: { $gte: oneDayAgo } \n          } \n        },\n        // STEP 3: Group by Hour (0-23)\n        { \n          $group: { \n            _id: { $hour: \"$convertedDate\" }, \n            count: { $sum: 1 } \n          } \n        },\n        // STEP 4: Sort by hour 0-23\n        { $sort: { _id: 1 } }\n      ]).toArray();\n\n      // Format for Chart.js (Ensure all 24 hours exist, fill missing with 0)\n      const data = new Array(24).fill(0);\n      activity.forEach((a: any) => {\n        if (a._id >= 0 && a._id < 24) {\n          data[a._id] = a.count;\n        }\n      });\n      \n      // Generate labels \"00:00\", \"01:00\", ... \"23:00\"\n      const labels = Array.from({length: 24}, (_, i) => \n        `${i.toString().padStart(2, '0')}:00`\n      );\n\n      return NextResponse.json({ labels, data });\n    }\n    \n    // Add other cases (sentiment_timeline, etc.) as needed based on the same pattern\n    return NextResponse.json([]);\n  } catch (e) {\n    return NextResponse.json({ error: 'Chart data failed' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,SAAS,MAAM,2HAAa;IAClC,MAAM,KAAK,OAAO,EAAE,CAAC;IAErB,IAAI;QACF,IAAI,SAAS,kBAAkB;YAC7B,iCAAiC;YACjC,MAAM,aAAa,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,MAAM,WAAW;YACpE,MAAM,MAAM,IAAI,KAAK,KAAK,GAAG,IAAI,WAAW;YAC5C,MAAM,QAAQ,MAAM,GAAG,UAAU,CAAC,aACjC,SAAS,CAAC;gBACT;oBAAE,QAAQ;wBAAE,YAAY;4BAAE,MAAM;4BAAY,MAAM;wBAAI;oBAAE;gBAAE;gBAC1D;oBAAE,QAAQ;wBAAE,KAAK;wBAAc,OAAO;4BAAE,MAAM;wBAAE;oBAAE;gBAAE;aACrD,EAAE,OAAO;YAEV,MAAM,SAAS;gBAAE,UAAU;gBAAG,UAAU;gBAAG,SAAS;gBAAG,SAAQ;gBAAG,OAAO;YAAE;YAC3E,MAAM,OAAO,CAAC,CAAC;gBACb,IAAI,EAAE,GAAG,IAAI,QAAQ,MAAM,CAAC,EAAE,GAAG,CAAwB,GAAG,EAAE,KAAK;gBACnE,OAAO,KAAK,IAAI,EAAE,KAAK;YACzB;YACA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QAEA,IAAI,SAAS,mBAAmB;YAC9B,4BAA4B;YAC5B,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;YAEvD,MAAM,WAAW,MAAM,GAAG,UAAU,CAAC,YAAY,SAAS,CAAC;gBACzD,gEAAgE;gBAChE;oBACE,YAAY;wBACV,eAAe;4BAAE,SAAS;wBAAc;oBAC1C;gBACF;gBACA,gDAAgD;gBAChD;oBACE,QAAQ;wBACN,eAAe;4BAAE,MAAM;wBAAU;oBACnC;gBACF;gBACA,+BAA+B;gBAC/B;oBACE,QAAQ;wBACN,KAAK;4BAAE,OAAO;wBAAiB;wBAC/B,OAAO;4BAAE,MAAM;wBAAE;oBACnB;gBACF;gBACA,4BAA4B;gBAC5B;oBAAE,OAAO;wBAAE,KAAK;oBAAE;gBAAE;aACrB,EAAE,OAAO;YAEV,uEAAuE;YACvE,MAAM,OAAO,IAAI,MAAM,IAAI,IAAI,CAAC;YAChC,SAAS,OAAO,CAAC,CAAC;gBAChB,IAAI,EAAE,GAAG,IAAI,KAAK,EAAE,GAAG,GAAG,IAAI;oBAC5B,IAAI,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,KAAK;gBACvB;YACF;YAEA,gDAAgD;YAChD,MAAM,SAAS,MAAM,IAAI,CAAC;gBAAC,QAAQ;YAAE,GAAG,CAAC,GAAG,IAC1C,GAAG,EAAE,QAAQ,GAAG,QAAQ,CAAC,GAAG,KAAK,GAAG,CAAC;YAGvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE;gBAAQ;YAAK;QAC1C;QAEA,iFAAiF;QACjF,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;IAC7B,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}