{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\nimport { MongoClient } from 'mongodb';\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nlet client;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>;\n  };\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    globalWithMongo._mongoClientPromise = client.connect();\n  }\n  clientPromise = globalWithMongo._mongoClientPromise;\n} else {\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AACjB;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/app/api/dashboard/sentiment/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport clientPromise from \"@/lib/mongodb\";\n\nexport async function GET() {\n  try {\n    const client = await clientPromise;\n    const db = client.db(\"bigdata\");\n\n    // Last 24 hours\n    const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n    const raw = await db.collection(\"sentiment\").aggregate([\n      { $addFields: { convertedDate: { $toDate: \"$created_at\" } } },\n\n      // Only last 24 hours\n      { $match: { convertedDate: { $gt: oneDayAgo } } },\n\n      // Group by hour\n      {\n        $group: {\n          _id: { hour: { $hour: \"$convertedDate\" } },\n          positive: {\n            $sum: { $cond: [{ $eq: [\"$sentiment\", \"positive\"] }, 1, 0] }\n          },\n          neutral: {\n            $sum: { $cond: [{ $eq: [\"$sentiment\", \"neutral\"] }, 1, 0] }\n          },\n          negative: {\n            $sum: { $cond: [{ $eq: [\"$sentiment\", \"negative\"] }, 1, 0] }\n          },\n          unknown: {\n            $sum: { $cond: [{ $eq: [\"$sentiment\", \"unknown\"] }, 1, 0] }\n          }\n        }\n      },\n\n      { $sort: { \"_id.hour\": 1 } }\n    ]).toArray();\n\n    // Build 24-hour array with empty hours filled\n    const timeline = Array.from({ length: 24 }, (_, hr) => {\n      const match = raw.find((r) => r._id.hour === hr);\n      return {\n        hour: hr,\n        positive: match?.positive ?? 0,\n        neutral: match?.neutral ?? 0,\n        negative: match?.negative ?? 0,\n        unknown: match?.unknown ?? 0,\n      };\n    });\n\n    return NextResponse.json({ timeline });\n  } catch (error) {\n    console.error(\"Sentiment API error:\", error);\n    return NextResponse.json({ error: \"Sentiment timeline failed\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,wIAAa;QAClC,MAAM,KAAK,OAAO,EAAE,CAAC;QAErB,gBAAgB;QAChB,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;QAEvD,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,aAAa,SAAS,CAAC;YACrD;gBAAE,YAAY;oBAAE,eAAe;wBAAE,SAAS;oBAAc;gBAAE;YAAE;YAE5D,qBAAqB;YACrB;gBAAE,QAAQ;oBAAE,eAAe;wBAAE,KAAK;oBAAU;gBAAE;YAAE;YAEhD,gBAAgB;YAChB;gBACE,QAAQ;oBACN,KAAK;wBAAE,MAAM;4BAAE,OAAO;wBAAiB;oBAAE;oBACzC,UAAU;wBACR,MAAM;4BAAE,OAAO;gCAAC;oCAAE,KAAK;wCAAC;wCAAc;qCAAW;gCAAC;gCAAG;gCAAG;6BAAE;wBAAC;oBAC7D;oBACA,SAAS;wBACP,MAAM;4BAAE,OAAO;gCAAC;oCAAE,KAAK;wCAAC;wCAAc;qCAAU;gCAAC;gCAAG;gCAAG;6BAAE;wBAAC;oBAC5D;oBACA,UAAU;wBACR,MAAM;4BAAE,OAAO;gCAAC;oCAAE,KAAK;wCAAC;wCAAc;qCAAW;gCAAC;gCAAG;gCAAG;6BAAE;wBAAC;oBAC7D;oBACA,SAAS;wBACP,MAAM;4BAAE,OAAO;gCAAC;oCAAE,KAAK;wCAAC;wCAAc;qCAAU;gCAAC;gCAAG;gCAAG;6BAAE;wBAAC;oBAC5D;gBACF;YACF;YAEA;gBAAE,OAAO;oBAAE,YAAY;gBAAE;YAAE;SAC5B,EAAE,OAAO;QAEV,8CAA8C;QAC9C,MAAM,WAAW,MAAM,IAAI,CAAC;YAAE,QAAQ;QAAG,GAAG,CAAC,GAAG;YAC9C,MAAM,QAAQ,IAAI,IAAI,CAAC,CAAC,IAAM,EAAE,GAAG,CAAC,IAAI,KAAK;YAC7C,OAAO;gBACL,MAAM;gBACN,UAAU,OAAO,YAAY;gBAC7B,SAAS,OAAO,WAAW;gBAC3B,UAAU,OAAO,YAAY;gBAC7B,SAAS,OAAO,WAAW;YAC7B;QACF;QAEA,OAAO,6JAAY,CAAC,IAAI,CAAC;YAAE;QAAS;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,6JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}