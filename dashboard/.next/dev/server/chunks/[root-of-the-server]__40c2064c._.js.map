{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\nimport { MongoClient } from 'mongodb';\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nlet client;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>;\n  };\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    globalWithMongo._mongoClientPromise = client.connect();\n  }\n  clientPromise = globalWithMongo._mongoClientPromise;\n} else {\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AACjB;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/app/api/dashboard/charts/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport clientPromise from '@/lib/mongodb';\n\ninterface SentimentAggRow {\n  _id: string;\n  count: number;\n}\n\ninterface SentimentChartResult {\n  positive: number;\n  negative: number;\n  neutral: number;\n  unknown: number;\n  total: number;\n}\n\ninterface HourlyActivityRow {\n  _id: number;\n  count: number;\n}\n\ninterface BasicDistRow {\n  _id: string | number | null;\n  count: number;\n}\n\ninterface SentimentTimelineRow {\n  _id: { hour: number };\n  positive: number;\n  neutral: number;\n  negative: number;\n  unknown: number;\n}\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const type = searchParams.get('type');\n  const client = await clientPromise;\n  const db = client.db('bigdata');\n\n  try {\n    /**\n     * SENTIMENT DISTRIBUTION — last 10 minutes\n     */\n    if (type === 'sentiment_dist') {\n      const tenMinsAgo = new Date(Date.now() - 10 * 60 * 1000).toISOString();\n      const now = new Date().toISOString();\n\n      const stats = await db\n        .collection('sentiment')\n        .aggregate<SentimentAggRow>([\n          { $match: { created_at: { $gte: tenMinsAgo, $lte: now } } },\n          { $group: { _id: '$sentiment', count: { $sum: 1 } } }\n        ])\n        .toArray();\n\n      const result: SentimentChartResult = {\n        positive: 0,\n        negative: 0,\n        neutral: 0,\n        unknown: 0,\n        total: 0\n      };\n\n      stats.forEach(row => {\n        if (row._id in result) {\n          const key = row._id as keyof SentimentChartResult;\n          if (key !== 'total') result[key] = row.count;\n        }\n        result.total += row.count;\n      });\n\n      return NextResponse.json(result);\n    }\n\n    /**\n     * HOURLY ENGAGEMENT — last 24 hours\n     */\n    if (type === 'activity_hourly') {\n      const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n      const activity = await db\n        .collection('language')\n        .aggregate<HourlyActivityRow>([\n          { $addFields: { convertedDate: { $toDate: '$created_at' } } },\n          { $match: { convertedDate: { $gte: oneDayAgo } } },\n          {\n            $group: {\n              _id: { $hour: '$convertedDate' },\n              count: { $sum: 1 }\n            }\n          },\n          { $sort: { _id: 1 } }\n        ])\n        .toArray();\n\n      const data = new Array<number>(24).fill(0);\n      activity.forEach(bucket => {\n        if (bucket._id >= 0 && bucket._id < 24) data[bucket._id] = bucket.count;\n      });\n\n      const labels = Array.from({ length: 24 }, (_, i) =>\n        `${i.toString().padStart(2, '0')}:00`\n      );\n\n      return NextResponse.json({ labels, data });\n    }\n\n    /**\n     * LANGUAGE DISTRIBUTION — last 24 hours\n     */\n    if (type === 'language_dist') {\n      const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();\n      const now = new Date().toISOString();\n\n      const langAgg = await db\n        .collection('language')\n        .aggregate<BasicDistRow>([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          { $group: { _id: '$lang', count: { $sum: 1 } } },\n          { $sort: { count: -1 } }\n        ])\n        .toArray();\n\n      const labels = langAgg.map(row =>\n        row._id === null || row._id === '' ? 'unknown' : String(row._id)\n      );\n      const data = langAgg.map(row => row.count);\n\n      return NextResponse.json({ labels, data });\n    }\n\n    /**\n     * TOPIC DISTRIBUTION — FIXED (uses topic_keywords, NOT Topic 1/2/3)\n     */\n    if (type === 'topic_dist') {\n      const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();\n      const now = new Date().toISOString();\n\n      const topicAgg = await db\n        .collection('topics')\n        .aggregate([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          {\n            $group: {\n              _id: '$topic',\n              count: { $sum: 1 },\n              keywords: { $first: '$topic_keywords' }\n            }\n          },\n          { $sort: { count: -1 } },\n          { $limit: 10 }\n        ])\n        .toArray();\n\n      const labels = topicAgg.map(row => {\n        if (Array.isArray(row.keywords) && row.keywords.length > 0) {\n          return row.keywords.slice(0, 3).join(', ');\n        }\n        return `Topic ${row._id}`;\n      });\n\n      const data = topicAgg.map(row => row.count);\n\n      return NextResponse.json({ labels, data });\n    }\n\n    /**\n     * SENTIMENT TIMELINE — 24h grouped by hour\n     */\n    if (type === 'sentiment_timeline') {\n      const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n      const raw = await db\n        .collection('sentiment')\n        .aggregate<SentimentTimelineRow>([\n          { $addFields: { convertedDate: { $toDate: '$created_at' } } },\n          { $match: { convertedDate: { $gt: oneDayAgo } } },\n          {\n            $group: {\n              _id: { hour: { $hour: '$convertedDate' } },\n              positive: { $sum: { $cond: [{ $eq: ['$sentiment', 'positive'] }, 1, 0] }},\n              neutral:  { $sum: { $cond: [{ $eq: ['$sentiment', 'neutral'] }, 1, 0] }},\n              negative: { $sum: { $cond: [{ $eq: ['$sentiment', 'negative'] }, 1, 0] }},\n              unknown:  { $sum: { $cond: [{ $eq: ['$sentiment', 'unknown'] }, 1, 0] }},\n            }\n          },\n          { $sort: { '_id.hour': 1 } }\n        ])\n        .toArray();\n\n      const timeline = Array.from({ length: 24 }, (_, hr) => {\n        const match = raw.find(r => r._id.hour === hr);\n        return {\n          hour: hr,\n          positive: match?.positive ?? 0,\n          neutral: match?.neutral ?? 0,\n          negative: match?.negative ?? 0,\n          unknown: match?.unknown ?? 0\n        };\n      });\n\n      return NextResponse.json({ timeline });\n    }\n\n    return NextResponse.json([]);\n  } catch (e) {\n    console.error('Chart route error:', e);\n    return NextResponse.json({ error: 'Chart data failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}