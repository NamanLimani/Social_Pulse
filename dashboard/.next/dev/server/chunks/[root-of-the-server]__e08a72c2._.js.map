{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/lib/mongodb.ts"],"sourcesContent":["// lib/mongodb.ts\nimport { MongoClient } from 'mongodb';\n\nif (!process.env.MONGODB_URI) {\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\n}\n\nconst uri = process.env.MONGODB_URI;\nconst options = {};\n\nlet client;\nlet clientPromise: Promise<MongoClient>;\n\nif (process.env.NODE_ENV === 'development') {\n  let globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>;\n  };\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    globalWithMongo._mongoClientPromise = client.connect();\n  }\n  clientPromise = globalWithMongo._mongoClientPromise;\n} else {\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;"],"names":[],"mappings":"AAAA,iBAAiB;;;;;AACjB;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/namanlimani/Desktop/project_copy/dashboard/app/api/dashboard/advanced/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport clientPromise from \"@/lib/mongodb\";\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const type = searchParams.get(\"type\");\n\n    const client = await clientPromise;\n    const db = client.db(\"bigdata\");\n\n    const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();\n    const now = new Date().toISOString();\n\n    // ------------------------------\n    // 1. TRENDING TOPICS\n    // ------------------------------\n    if (type === \"trending_topics\") {\n      const docs = await db\n        .collection(\"topics\")\n        .aggregate([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          {\n            $group: {\n              _id: \"$topic\",\n              count: { $sum: 1 },\n              keywords: { $first: \"$topic_keywords\" }\n            }\n          },\n          { $sort: { count: -1 } },\n          { $limit: 10 }\n        ])\n        .toArray();\n\n      return NextResponse.json(\n        docs.map((d) => ({\n          topic_keywords: d.keywords || [],\n          count: d.count\n        }))\n      );\n    }\n\n    // ------------------------------\n    // 2. ANOMALY TIMELINE (HOURLY)\n    // ------------------------------\n    if (type === \"anomaly_timeline\") {\n      const timeline = await db\n        .collection(\"anomalies\")\n        .aggregate([\n          { $addFields: { conv: { $toDate: \"$created_at\" } } },\n          { $match: { conv: { $gte: new Date(oneDayAgo) } } },\n          {\n            $group: {\n              _id: { hour: { $hour: \"$conv\" } },\n              count: { $sum: 1 }\n            }\n          },\n          { $sort: { \"_id.hour\": 1 } }\n        ])\n        .toArray();\n\n      const full = Array.from({ length: 24 }, (_, hr) => {\n        const found = timeline.find((t) => t._id.hour === hr);\n        return { hour: hr, count: found?.count ?? 0 };\n      });\n\n      return NextResponse.json(full);\n    }\n\n    // ------------------------------\n    // 3. ANOMALY FREQUENCY BY TOPIC\n    // ------------------------------\n    if (type === \"anomaly_frequency\") {\n      const freq = await db\n        .collection(\"anomalies\")\n        .aggregate([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          {\n            $group: {\n              _id: \"$topic\",\n              count: { $sum: 1 },\n              keywords: { $first: \"$topic_keywords\" }\n            }\n          },\n          { $sort: { count: -1 } }\n        ])\n        .toArray();\n\n      return NextResponse.json(\n        freq.map((f) => ({\n          topic_keywords: f.keywords || [],\n          count: f.count\n        }))\n      );\n    }\n\n    // ------------------------------\n    // 4. ENTITY ANALYTICS (TOP 10)\n    // ------------------------------\n    if (type === \"entities_top\") {\n      const entities = await db\n        .collection(\"entities\")\n        .aggregate([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          { $unwind: \"$entities\" },\n          {$match: {\n            \"entities.label\": { $in: [\"PERSON\", \"ORG\", \"GPE\", \"EVENT\", \"PRODUCT\", \"WORK_OF_ART\"] }\n          }},\n          {\n            $group: {\n              _id: \"$entities.text\",\n              count: { $sum: 1 }\n            }\n          },\n          { $sort: { count: -1 } },\n          { $limit: 10 }\n        ])\n        .toArray();\n\n      return NextResponse.json(\n        entities.map((e) => ({\n          entity: e._id,\n          count: e.count\n        }))\n      );\n    }\n\n    // ------------------------------\n    // 5. HASHTAG ANALYTICS (TOP 20)\n    // ------------------------------\n    if (type === \"hashtags_top\") {\n      const tags = await db\n        .collection(\"hashtags\")\n        .aggregate([\n          { $match: { created_at: { $gte: oneDayAgo, $lte: now } } },\n          { $unwind: \"$hashtags\" },\n          {\n            $group: {\n              _id: \"$hashtags\",\n              count: { $sum: 1 }\n            }\n          },\n          { $sort: { count: -1 } },\n          { $limit: 20 }\n        ])\n        .toArray();\n\n      return NextResponse.json(\n        tags.map((t) => ({\n          hashtag: t._id,\n          count: t.count\n        }))\n      );\n    }\n\n    // ------------------------------\n    // 6. SUMMARY FEED\n    // ------------------------------\n    if (type === \"summaries\") {\n      const list = await db\n        .collection(\"summaries\")\n        .find({\n          created_at: { $gte: oneDayAgo, $lte: now }\n        })\n        .sort({ created_at: -1 })\n        .limit(30)\n        .toArray();\n\n      return NextResponse.json(\n        list.map((s) => ({\n          summary: s.summary,\n          text: s.text,\n          sentiment: s.sentiment,\n          topic_keywords: s.topic_keywords?.slice(0, 3) || []\n        }))\n      );\n    }\n\n    return NextResponse.json({ error: \"Invalid type\" });\n  } catch (err) {\n    console.error(\"ADVANCED API ERROR:\", err);\n    return NextResponse.json(\n      { error: \"Advanced API failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}